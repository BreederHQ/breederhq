// BreederHQ Full Database Schema
// Generated from Prisma schema
// Import into dbdiagram.io for visual editing

Project BreederHQ {
  database_type: 'PostgreSQL'
  Note: 'Complete ERD for BreederHQ animal breeding management platform'
}

// =============================================================================
// ENUMS
// =============================================================================

Enum PartyType { CONTACT; ORGANIZATION }
Enum MembershipRole { OWNER; ADMIN; MEMBER; VIEWER }
Enum AnimalStatus { ACTIVE; BREEDING; UNAVAILABLE; RETIRED; DECEASED; PROSPECT }
Enum Species { DOG; CAT; HORSE; GOAT; RABBIT; SHEEP }
Enum TenantOperationType { HOBBY; COMMERCIAL; PERFORMANCE }
Enum HorseIntendedUse { BREEDING; SHOW; RACING }
Enum HorseValuationSource { PRIVATE_SALE; AUCTION; APPRAISAL; INSURANCE; OTHER }
Enum OwnershipChangeKind { SALE; SYNDICATION; TRANSFER; LEASE; DEATH; OTHER }
Enum PaymentIntentStatus { PLANNED; EXTERNAL; COMPLETED; CANCELED }
Enum PaymentIntentPurpose { DEPOSIT; PURCHASE; STUD_FEE; BOARDING; TRAINING; OTHER }
Enum Sex { FEMALE; MALE }
Enum TagModule { CONTACT; ORGANIZATION; ANIMAL; WAITLIST_ENTRY; OFFSPRING_GROUP; OFFSPRING }
Enum TenantRole { OWNER; ADMIN; MEMBER; BILLING; VIEWER }
Enum TenantMembershipRole { STAFF; CLIENT }
Enum TenantMembershipStatus { INVITED; ACTIVE; SUSPENDED }
Enum ShareScope { VIEW; BREED_PLAN }
Enum ShareStatus { PENDING; ACCEPTED; REVOKED; EXPIRED }
Enum VerificationPurpose { VERIFY_EMAIL; RESET_PASSWORD; INVITE; OTHER }
Enum PortalAccessStatus { NO_ACCESS; INVITED; ACTIVE; SUSPENDED }
Enum EntitlementKey { MARKETPLACE_ACCESS }
Enum EntitlementStatus { ACTIVE; REVOKED }
Enum CommChannel { EMAIL; SMS; PHONE; MAIL; WHATSAPP }
Enum PreferenceLevel { ALLOW; NOT_PREFERRED; NEVER }
Enum ComplianceStatus { SUBSCRIBED; UNSUBSCRIBED }
Enum TraitValueType { BOOLEAN; ENUM; NUMBER; DATE; TEXT; JSON }
Enum TraitSource { SELF_REPORTED; VET; LAB; REGISTRY }
Enum TraitStatus { NOT_PROVIDED; PROVIDED; PENDING; PASS; FAIL }
Enum DocVisibility { PRIVATE; BUYERS; PUBLIC }
Enum DocStatus { PLACEHOLDER; UPLOADING; READY; FAILED }
Enum BreedingPlanStatus { PLANNING; COMMITTED; CYCLE_EXPECTED; HORMONE_TESTING; BRED; PREGNANT; BIRTHED; WEANED; PLACEMENT; COMPLETE; CANCELED }
Enum BreedingMethod { NATURAL; AI_TCI; AI_SI; AI_FROZEN }
Enum PregnancyCheckMethod { PALPATION; ULTRASOUND; RELAXIN_TEST; XRAY; OTHER }
Enum WaitlistStatus { INQUIRY; DEPOSIT_DUE; DEPOSIT_PAID; READY; ALLOCATED; COMPLETED; CANCELED }
Enum OffspringLinkState { linked; orphan; pending }
Enum OffspringLinkReason { legacy_import; rescue; accidental; third_party; cobreeder; placeholder; historical; other }
Enum OffspringStatus { NEWBORN; ALIVE; WEANED; PLACED; DECEASED }
Enum OffspringLifeState { ALIVE; DECEASED }
Enum OffspringPlacementState { UNASSIGNED; OPTION_HOLD; RESERVED; PLACED; RETURNED; TRANSFERRED }
Enum OffspringKeeperIntent { AVAILABLE; UNDER_EVALUATION; WITHHELD; KEEP }
Enum OffspringFinancialState { NONE; DEPOSIT_PENDING; DEPOSIT_PAID; PAID_IN_FULL; REFUNDED; CHARGEBACK }
Enum OffspringPaperworkState { NONE; SENT; SIGNED; COMPLETE }
Enum AnimalListingIntent { STUD; BROOD_PLACEMENT; REHOME; SHOWCASE }
Enum AnimalListingStatus { DRAFT; LIVE; PAUSED }
Enum FinanceScope { group; offspring; contact; organization; general }
Enum InvoiceStatus { draft; issued; partially_paid; paid; void; uncollectible; refunded; cancelled }
Enum InvoiceCategory { DEPOSIT; SERVICE; GOODS; MIXED; OTHER }
Enum LineItemKind { DEPOSIT; SERVICE_FEE; GOODS; DISCOUNT; TAX; OTHER }
Enum PaymentStatus { pending; succeeded; failed; refunded; disputed; cancelled }
Enum ExpenseCategory { VETERINARY; FEED; SUPPLIES; BREEDING_FEE; BOARDING; TRAINING; TRANSPORT; MARKETING; ADMINISTRATIVE; FACILITIES; INSURANCE; OTHER }
Enum CampaignChannel { email; social; ads; marketplace; website; other }
Enum TaskScope { group; offspring }
Enum TaskStatus { open; in_progress; done; cancelled }
Enum HealthType { weight; vaccine; deworm; vet_visit; treatment; other }
Enum DocumentScope { group; offspring; invoice; contract; animal }
Enum DocumentKind { generic; health_certificate; registration; contract_pdf; invoice_pdf; photo; other; bill_of_sale; syndication_agreement; lease_agreement; insurance_policy; vet_certificate }
Enum SignatureProvider { internal; docusign; hellosign; adobe; other }
Enum ContractStatus { draft; sent; viewed; signed; declined; voided; expired }
Enum SignatureStatus { pending; viewed; signed; declined; voided; expired }
Enum InvoiceRole { RESERVATION; DEPOSIT; FINAL; MISC }
Enum EsignProvider { DOCUSIGN; HELLOSIGN; ADOBE; OTHER }
Enum EsignStatus { DRAFT; SENT; VIEWED; SIGNED; DECLINED; EXPIRED; VOIDED }
Enum EmailSendStatus { queued; sent; failed }
Enum TemplateChannel { email; dm; social }
Enum TemplateStatus { draft; active; archived }
Enum TemplateCategory { auto_reply; invoice_message; birth_announcement; waitlist_update; general_follow_up; custom }
Enum EmailSendCategory { transactional; marketing }
Enum AutoReplyTriggerType { dm_first_message_from_party; dm_after_hours }
Enum AutoReplyStatus { sent; skipped; failed }
Enum AuditOutcome { SUCCESS; FAILURE }
Enum AuditSurface { PLATFORM; PORTAL; MARKETPLACE }
Enum AuditActorContext { STAFF; CLIENT; PUBLIC }
Enum SchedulingEventStatus { DRAFT; OPEN; CLOSED; CANCELLED }
Enum SchedulingSlotStatus { AVAILABLE; FULL; CANCELLED }
Enum SchedulingSlotMode { IN_PERSON; VIRTUAL }
Enum SchedulingBookingStatus { CONFIRMED; CANCELLED; RESCHEDULED; NO_SHOW }

// =============================================================================
// USERS & AUTH
// =============================================================================

Table User {
  id varchar [pk]
  email varchar [unique, not null]
  name varchar
  firstName varchar [not null]
  lastName varchar [not null]
  nickname varchar
  image varchar
  passwordHash varchar
  passwordUpdatedAt timestamp
  mustChangePassword boolean [default: false]
  isSuperAdmin boolean [default: false]
  emailVerifiedAt timestamp
  phoneE164 varchar(32)
  whatsappE164 varchar(32)
  street varchar
  city varchar
  state varchar
  postalCode varchar
  country char(2)
  partyId int [ref: > Party.id]
  defaultTenantId int [ref: > Tenant.id]
  lastLoginAt timestamp
  createdAt timestamp [default: `now()`]
  updatedAt timestamp
}

Table Session {
  id varchar [pk]
  userId varchar [not null, ref: > User.id]
  expires timestamp [not null]
  sessionToken varchar [unique, not null]
  createdAt timestamp [default: `now()`]
  updatedAt timestamp
}

Table Passkey {
  id varchar [pk]
  userId varchar [not null, ref: > User.id]
  credentialId varchar [unique, not null]
  publicKey varchar [not null]
  counter int [default: 0]
  createdAt timestamp [default: `now()`]
  updatedAt timestamp
}

Table RecoveryCode {
  id varchar [pk]
  userId varchar [not null, ref: > User.id]
  code varchar [unique, not null]
  used boolean [default: false]
  createdAt timestamp [default: `now()`]
}

Table VerificationToken {
  identifier varchar [not null]
  tokenHash varchar [unique, not null]
  token varchar [unique]
  purpose VerificationPurpose [default: 'VERIFY_EMAIL']
  expires timestamp [not null]
  userId varchar [ref: > User.id]
  createdAt timestamp [default: `now()`]
}

Table TosAcceptance {
  id int [pk, increment]
  userId varchar [not null, ref: > User.id]
  version varchar(16) [not null]
  acceptedAt timestamp [default: `now()`]
  ipAddress varchar(45)
  userAgent text
  surface varchar(32)
  flow varchar(32)
}

Table UserEntitlement {
  id int [pk, increment]
  userId varchar [not null, ref: > User.id]
  key EntitlementKey [not null]
  status EntitlementStatus [default: 'ACTIVE']
  grantedAt timestamp [default: `now()`]
  revokedAt timestamp
  grantedByUserId varchar
}

// =============================================================================
// TENANTS & ORGANIZATIONS
// =============================================================================

Table Tenant {
  id int [pk, increment]
  name varchar [not null]
  slug varchar [unique]
  primaryEmail varchar
  operationType TenantOperationType [default: 'HOBBY']
  availabilityPrefs json
  createdAt timestamp [default: `now()`]
  updatedAt timestamp
}

Table TenantMembership {
  userId varchar [not null, ref: > User.id]
  tenantId int [not null, ref: > Tenant.id]
  role TenantRole [default: 'MEMBER']
  membershipRole TenantMembershipRole [default: 'STAFF']
  membershipStatus TenantMembershipStatus [default: 'ACTIVE']
  partyId int [ref: > Party.id]
  createdAt timestamp [default: `now()`]
  updatedAt timestamp
  indexes { (userId, tenantId) [pk] }
}

Table TenantSetting {
  tenantId int [not null, ref: > Tenant.id]
  namespace varchar [not null]
  version int [default: 1]
  data json [not null]
  updatedBy varchar
  createdAt timestamp [default: `now()`]
  updatedAt timestamp
  indexes { (tenantId, namespace) [pk] }
}

Table BillingAccount {
  id int [pk, increment]
  tenantId int [unique, not null, ref: - Tenant.id]
  provider varchar
  customerId varchar
  subscriptionId varchar
  plan varchar
  status varchar
  currentPeriodEnd timestamp
  createdAt timestamp [default: `now()`]
  updatedAt timestamp
}

Table Organization {
  id int [pk, increment]
  tenantId int [not null, ref: > Tenant.id]
  partyId int [unique, not null, ref: - Party.id]
  name varchar [not null]
  email varchar
  phone varchar
  website varchar
  street varchar
  city varchar
  state varchar
  zip varchar
  country varchar
  archived boolean [default: false]
  programSlug varchar
  isPublicProgram boolean [default: false]
  programBio text
  publicContactEmail varchar
  createdAt timestamp [default: `now()`]
  updatedAt timestamp
}

Table Membership {
  userId varchar [not null, ref: > User.id]
  organizationId int [not null, ref: > Organization.id]
  role MembershipRole [default: 'MEMBER']
  indexes { (userId, organizationId) [pk] }
}

Table Invitation {
  id varchar [pk]
  email varchar [not null]
  organizationId int [not null, ref: > Organization.id]
  role MembershipRole [default: 'MEMBER']
  token varchar [unique, not null]
  expiresAt timestamp [not null]
  acceptedAt timestamp
  createdAt timestamp [default: `now()`]
}

Table Party {
  id int [pk, increment]
  tenantId int [not null, ref: > Tenant.id]
  type PartyType [not null]
  name varchar [not null]
  email varchar
  phoneE164 varchar(32)
  whatsappE164 varchar(32)
  street varchar
  city varchar
  state varchar
  postalCode varchar
  country char(2)
  archived boolean [default: false]
  createdAt timestamp [default: `now()`]
  updatedAt timestamp
}

Table Contact {
  id int [pk, increment]
  tenantId int [not null, ref: > Tenant.id]
  organizationId int [ref: > Organization.id]
  partyId int [unique, ref: - Party.id]
  display_name varchar [not null]
  first_name varchar
  last_name varchar
  nickname varchar
  email varchar
  phoneE164 varchar(32)
  street varchar
  city varchar
  state varchar
  zip varchar
  country char(2)
  archived boolean [default: false]
  createdAt timestamp [default: `now()`]
  updatedAt timestamp
}

Table PartyCommPreference {
  id int [pk, increment]
  partyId int [not null, ref: > Party.id]
  channel CommChannel [not null]
  preference PreferenceLevel [default: 'ALLOW']
  compliance ComplianceStatus
  complianceSetAt timestamp
  createdAt timestamp [default: `now()`]
  updatedAt timestamp
}

// =============================================================================
// ANIMALS
// =============================================================================

Table Animal {
  id int [pk, increment]
  tenantId int [not null, ref: > Tenant.id]
  organizationId int [ref: > Organization.id]
  name varchar [not null]
  species Species [not null]
  sex Sex [not null]
  status AnimalStatus [default: 'ACTIVE']
  intendedUse HorseIntendedUse
  declaredValueCents int
  birthDate timestamp
  microchip varchar
  notes varchar
  breed varchar
  photoUrl text
  canonicalBreedId int [ref: > Breed.id]
  customBreedId int [ref: > CustomBreed.id]
  litterId int [ref: > Litter.id]
  offspringGroupId int [ref: > OffspringGroup.id]
  buyerPartyId int [ref: > Party.id]
  priceCents int
  archived boolean [default: false]
  createdAt timestamp [default: `now()`]
  updatedAt timestamp
}

Table AnimalOwner {
  id int [pk, increment]
  animalId int [not null, ref: > Animal.id]
  partyId int [not null, ref: > Party.id]
  percent int [not null]
  isPrimary boolean [default: false]
  createdAt timestamp [default: `now()`]
  updatedAt timestamp
}

Table Breed {
  id int [pk, increment]
  name varchar [unique, not null]
  slug varchar [unique, not null]
  species Species [not null]
  createdAt timestamp [default: `now()`]
  updatedAt timestamp
}

Table AnimalBreed {
  id int [pk, increment]
  animalId int [not null, ref: > Animal.id]
  breedId int [not null, ref: > Breed.id]
  percentage float [default: 100]
  createdAt timestamp [default: `now()`]
  updatedAt timestamp
}

Table CustomBreed {
  id int [pk, increment]
  tenantId int [not null, ref: > Tenant.id]
  createdByOrganizationId int [ref: > Organization.id]
  species Species [not null]
  name varchar [not null]
  composition json
  createdAt timestamp [default: `now()`]
  updatedAt timestamp
}

Table Registry {
  id int [pk, increment]
  name varchar [not null]
  code varchar [unique]
  url varchar
  country varchar
  species Species
  createdAt timestamp [default: `now()`]
  updatedAt timestamp
}

Table AnimalRegistryIdentifier {
  id int [pk, increment]
  animalId int [not null, ref: > Animal.id]
  registryId int [not null, ref: > Registry.id]
  identifier varchar [not null]
  registrarOfRecord varchar
  issuedAt timestamp
  createdAt timestamp [default: `now()`]
  updatedAt timestamp
}

Table BreedRegistryLink {
  breedId int [not null, ref: > Breed.id]
  registryId int [not null, ref: > Registry.id]
  statusText varchar
  registryRef varchar
  primary boolean
  since int
  indexes { (breedId, registryId) [pk] }
}

Table AnimalShare {
  id int [pk, increment]
  animalId int [not null, ref: > Animal.id]
  fromTenantId int [not null, ref: > Tenant.id]
  toTenantId int [not null, ref: > Tenant.id]
  scope ShareScope [default: 'VIEW']
  status ShareStatus [default: 'PENDING']
  message varchar
  expiresAt timestamp
  createdAt timestamp [default: `now()`]
  updatedAt timestamp
}

Table AnimalPublicListing {
  id int [pk, increment]
  animalId int [unique, not null, ref: - Animal.id]
  tenantId int [not null, ref: > Tenant.id]
  urlSlug varchar [unique]
  intent AnimalListingIntent
  status AnimalListingStatus [default: 'DRAFT']
  headline varchar(120)
  title varchar
  description text
  isListed boolean [default: false]
  priceCents int
  createdAt timestamp [default: `now()`]
  updatedAt timestamp
}

Table AnimalOwnershipChange {
  id int [pk, increment]
  tenantId int [not null, ref: > Tenant.id]
  animalId int [not null, ref: > Animal.id]
  kind OwnershipChangeKind [not null]
  effectiveDate timestamp
  occurredAt timestamp [default: `now()`]
  valueCents int
  fromOwners json [not null]
  toOwners json [not null]
  notes varchar
  createdAt timestamp [default: `now()`]
  updatedAt timestamp
}

// =============================================================================
// TRAITS
// =============================================================================

Table TraitDefinition {
  id int [pk, increment]
  tenantId int [ref: > Tenant.id]
  species Species [not null]
  key varchar [not null]
  displayName varchar [not null]
  category varchar [not null]
  valueType TraitValueType [not null]
  enumValues json
  requiresDocument boolean [default: false]
  sortOrder int
  createdAt timestamp [default: `now()`]
  updatedAt timestamp
}

Table AnimalTraitValue {
  id int [pk, increment]
  tenantId int [not null, ref: > Tenant.id]
  animalId int [not null, ref: > Animal.id]
  traitDefinitionId int [not null, ref: > TraitDefinition.id]
  valueBoolean boolean
  valueNumber float
  valueText varchar
  valueDate timestamp
  valueJson json
  status TraitStatus
  source TraitSource
  verified boolean [default: false]
  marketplaceVisible boolean
  notes varchar
  createdAt timestamp [default: `now()`]
  updatedAt timestamp
}

// =============================================================================
// BREEDING
// =============================================================================

Table BreedingPlan {
  id int [pk, increment]
  tenantId int [not null, ref: > Tenant.id]
  organizationId int [ref: > Organization.id]
  code varchar
  name varchar [not null]
  species Species [not null]
  damId int [ref: > Animal.id]
  sireId int [ref: > Animal.id]
  expectedCycleStart timestamp
  expectedBirthDate timestamp
  expectedWeaned timestamp
  status BreedingPlanStatus [default: 'PLANNING']
  notes varchar
  committedAt timestamp
  committedByUserId varchar [ref: > User.id]
  archived boolean [default: false]
  createdAt timestamp [default: `now()`]
  updatedAt timestamp
}

Table ReproductiveCycle {
  id int [pk, increment]
  tenantId int [not null, ref: > Tenant.id]
  femaleId int [not null, ref: > Animal.id]
  cycleStart timestamp [not null]
  ovulation timestamp
  dueDate timestamp
  status varchar
  notes varchar
  createdAt timestamp [default: `now()`]
  updatedAt timestamp
}

Table BreedingPlanShare {
  id int [pk, increment]
  planId int [not null, ref: > BreedingPlan.id]
  fromTenantId int [not null, ref: > Tenant.id]
  toTenantId int [not null, ref: > Tenant.id]
  scope ShareScope [default: 'BREED_PLAN']
  status ShareStatus [default: 'PENDING']
  createdAt timestamp [default: `now()`]
  updatedAt timestamp
}

Table BreedingPlanEvent {
  id int [pk, increment]
  tenantId int [not null, ref: > Tenant.id]
  planId int [not null, ref: > BreedingPlan.id]
  type varchar [not null]
  occurredAt timestamp [not null]
  label varchar
  notes varchar
  data json
  recordedByUserId varchar [ref: > User.id]
  createdAt timestamp [default: `now()`]
  updatedAt timestamp
}

Table TestResult {
  id int [pk, increment]
  tenantId int [not null, ref: > Tenant.id]
  planId int [ref: > BreedingPlan.id]
  animalId int [ref: > Animal.id]
  kind varchar [not null]
  method varchar
  labName varchar
  valueNumber float
  valueText varchar
  units varchar
  collectedAt timestamp [not null]
  resultAt timestamp
  notes varchar
  createdAt timestamp [default: `now()`]
  updatedAt timestamp
}

Table BreedingAttempt {
  id int [pk, increment]
  tenantId int [not null, ref: > Tenant.id]
  planId int [not null, ref: > BreedingPlan.id]
  method BreedingMethod [not null]
  attemptAt timestamp
  studOwnerPartyId int [ref: > Party.id]
  success boolean
  notes varchar
  createdAt timestamp [default: `now()`]
  updatedAt timestamp
}

Table PregnancyCheck {
  id int [pk, increment]
  tenantId int [not null, ref: > Tenant.id]
  planId int [not null, ref: > BreedingPlan.id]
  method PregnancyCheckMethod [not null]
  result boolean [not null]
  checkedAt timestamp [not null]
  notes varchar
  createdAt timestamp [default: `now()`]
  updatedAt timestamp
}

Table PlanParty {
  id int [pk, increment]
  tenantId int [not null, ref: > Tenant.id]
  planId int [not null, ref: > BreedingPlan.id]
  role varchar [not null]
  partyId int [ref: > Party.id]
  notes varchar
}

// =============================================================================
// OFFSPRING & LITTERS
// =============================================================================

Table OffspringGroup {
  id int [pk, increment]
  tenantId int [not null, ref: > Tenant.id]
  planId int [unique, ref: - BreedingPlan.id]
  linkState OffspringLinkState [default: 'linked']
  species Species [not null]
  damId int [ref: > Animal.id]
  sireId int [ref: > Animal.id]
  name varchar
  expectedBirthOn timestamp
  actualBirthOn timestamp
  countBorn int
  countLive int
  countWeaned int
  countPlaced int
  weanedAt timestamp
  placementStartAt timestamp
  placementCompletedAt timestamp
  published boolean [default: false]
  listingSlug varchar
  notes varchar
  createdAt timestamp [default: `now()`]
  updatedAt timestamp
}

Table Offspring {
  id int [pk, increment]
  tenantId int [not null, ref: > Tenant.id]
  groupId int [not null, ref: > OffspringGroup.id]
  name varchar
  species Species [not null]
  breed varchar
  sex Sex
  bornAt timestamp
  diedAt timestamp
  status OffspringStatus [default: 'NEWBORN']
  lifeState OffspringLifeState [default: 'ALIVE']
  placementState OffspringPlacementState [default: 'UNASSIGNED']
  keeperIntent OffspringKeeperIntent [default: 'AVAILABLE']
  financialState OffspringFinancialState [default: 'NONE']
  paperworkState OffspringPaperworkState [default: 'NONE']
  damId int [ref: > Animal.id]
  sireId int [ref: > Animal.id]
  collarColorName varchar
  collarColorHex varchar
  buyerPartyId int [ref: > Party.id]
  priceCents int
  depositCents int
  promotedAnimalId int [ref: > Animal.id]
  notes varchar
  createdAt timestamp [default: `now()`]
  updatedAt timestamp
}

Table OffspringEvent {
  id int [pk, increment]
  tenantId int [not null, ref: > Tenant.id]
  offspringId int [not null, ref: > Offspring.id]
  type varchar [not null]
  occurredAt timestamp [not null]
  field varchar
  before json
  after json
  notes varchar
  recordedByUserId varchar [ref: > User.id]
  createdAt timestamp [default: `now()`]
  updatedAt timestamp
}

Table OffspringGroupEvent {
  id int [pk, increment]
  tenantId int [not null, ref: > Tenant.id]
  offspringGroupId int [not null, ref: > OffspringGroup.id]
  type varchar [not null]
  occurredAt timestamp [not null]
  field varchar
  before json
  after json
  notes varchar
  recordedByUserId varchar [ref: > User.id]
  createdAt timestamp [default: `now()`]
  updatedAt timestamp
}

Table OffspringGroupBuyer {
  id int [pk, increment]
  tenantId int [not null, ref: > Tenant.id]
  groupId int [not null, ref: > OffspringGroup.id]
  buyerPartyId int [ref: > Party.id]
  waitlistEntryId int [ref: > WaitlistEntry.id]
  placementRank int
  createdAt timestamp [default: `now()`]
  updatedAt timestamp
}

Table Litter {
  id int [pk, increment]
  tenantId int [not null, ref: > Tenant.id]
  planId int [unique, not null, ref: - BreedingPlan.id]
  identifier varchar
  birthedStartAt timestamp
  birthedEndAt timestamp
  countBorn int
  countLive int
  weanedAt timestamp
  published boolean [default: false]
  notes varchar
  createdAt timestamp [default: `now()`]
  updatedAt timestamp
}

Table LitterEvent {
  id int [pk, increment]
  tenantId int [not null, ref: > Tenant.id]
  litterId int [not null, ref: > Litter.id]
  type varchar [not null]
  occurredAt timestamp [not null]
  field varchar
  before json
  after json
  notes varchar
  recordedByUserId varchar [ref: > User.id]
  createdAt timestamp [default: `now()`]
  updatedAt timestamp
}

Table WaitlistEntry {
  id int [pk, increment]
  tenantId int [not null, ref: > Tenant.id]
  planId int [ref: > BreedingPlan.id]
  litterId int [ref: > Litter.id]
  offspringGroupId int [ref: > OffspringGroup.id]
  clientPartyId int [ref: > Party.id]
  speciesPref Species
  breedPrefs json
  sirePrefId int [ref: > Animal.id]
  damPrefId int [ref: > Animal.id]
  status WaitlistStatus [default: 'INQUIRY']
  priority int
  depositPaidAt timestamp
  depositRequiredCents int
  depositPaidCents int
  animalId int [ref: > Animal.id]
  offspringId int [ref: > Offspring.id]
  notes varchar
  createdAt timestamp [default: `now()`]
  updatedAt timestamp
}

// =============================================================================
// FINANCE
// =============================================================================

Table Invoice {
  id int [pk, increment]
  tenantId int [not null, ref: > Tenant.id]
  scope FinanceScope [not null]
  groupId int [ref: > OffspringGroup.id]
  offspringId int [ref: > Offspring.id]
  clientPartyId int [ref: > Party.id]
  animalId int [ref: > Animal.id]
  breedingPlanId int [ref: > BreedingPlan.id]
  invoiceNumber varchar [not null]
  currency varchar [default: 'USD']
  amountCents int [not null]
  balanceCents int [not null]
  status InvoiceStatus [default: 'draft']
  category InvoiceCategory [default: 'OTHER']
  dueAt timestamp
  issuedAt timestamp
  paidAt timestamp
  notes varchar
  createdAt timestamp [default: `now()`]
  updatedAt timestamp
}

Table InvoiceLineItem {
  id int [pk, increment]
  tenantId int [not null, ref: > Tenant.id]
  invoiceId int [not null, ref: > Invoice.id]
  kind LineItemKind [default: 'OTHER']
  description varchar [not null]
  qty int [default: 1]
  unitCents int [not null]
  totalCents int [not null]
  createdAt timestamp [default: `now()`]
}

Table Payment {
  id int [pk, increment]
  tenantId int [not null, ref: > Tenant.id]
  invoiceId int [not null, ref: > Invoice.id]
  status PaymentStatus [default: 'pending']
  amountCents int [not null]
  receivedAt timestamp [not null]
  methodType varchar
  processor varchar
  processorRef varchar
  notes varchar
  createdAt timestamp [default: `now()`]
}

Table Expense {
  id int [pk, increment]
  tenantId int [not null, ref: > Tenant.id]
  amountCents int [not null]
  currency varchar [default: 'USD']
  incurredAt timestamp [not null]
  category ExpenseCategory [not null]
  description varchar
  vendorPartyId int [ref: > Party.id]
  breedingPlanId int [ref: > BreedingPlan.id]
  offspringGroupId int [ref: > OffspringGroup.id]
  animalId int [ref: > Animal.id]
  notes varchar
  createdAt timestamp [default: `now()`]
  updatedAt timestamp
}

Table PaymentIntent {
  id int [pk, increment]
  tenantId int [not null, ref: > Tenant.id]
  invoiceId int [ref: > Invoice.id]
  animalId int [ref: > Animal.id]
  ownershipChangeId int [ref: > AnimalOwnershipChange.id]
  purpose PaymentIntentPurpose [not null]
  status PaymentIntentStatus [default: 'PLANNED']
  amountCents int [not null]
  currency varchar(3) [not null]
  createdAt timestamp [default: `now()`]
  updatedAt timestamp
}

Table Sequence {
  id int [pk, increment]
  tenantId int [not null, ref: > Tenant.id]
  key varchar [not null]
  year int [not null]
  nextNumber int [default: 1]
  createdAt timestamp [default: `now()`]
  updatedAt timestamp
}

Table OffspringInvoiceLink {
  id int [pk, increment]
  tenantId int [not null, ref: > Tenant.id]
  offspringId int [not null, ref: > Offspring.id]
  invoiceId int [ref: > Invoice.id]
  role InvoiceRole [default: 'MISC']
  amountCents int
  createdAt timestamp [default: `now()`]
  updatedAt timestamp
}

Table AccountingIntegration {
  id int [pk, increment]
  tenantId int [not null, ref: > Tenant.id]
  provider varchar [not null]
  realmId varchar [not null]
  accessToken varchar [not null]
  refreshToken varchar [not null]
  accessTokenExpiresAt timestamp [not null]
  isActive boolean [default: true]
  syncDirection varchar [default: 'outbound']
  lastSyncAt timestamp
  createdAt timestamp [default: `now()`]
  updatedAt timestamp
}

// =============================================================================
// MARKETING & MESSAGING
// =============================================================================

Table Campaign {
  id int [pk, increment]
  tenantId int [not null, ref: > Tenant.id]
  offspringGroupId int [ref: > OffspringGroup.id]
  name varchar [not null]
  channel CampaignChannel [not null]
  startedAt timestamp
  endedAt timestamp
  budgetCents int
  spendCents int
  impressions int
  clicks int
  conversions int
  utmSource varchar
  utmMedium varchar
  utmCampaign varchar
  notes varchar
  createdAt timestamp [default: `now()`]
  updatedAt timestamp
}

Table CampaignAttribution {
  id int [pk, increment]
  tenantId int [not null, ref: > Tenant.id]
  campaignId int [not null, ref: > Campaign.id]
  offspringId int [ref: > Offspring.id]
  weight float
  createdAt timestamp [default: `now()`]
}

Table Template {
  id int [pk, increment]
  tenantId int [not null, ref: > Tenant.id]
  name varchar [not null]
  key varchar
  channel TemplateChannel [not null]
  category TemplateCategory [not null]
  status TemplateStatus [default: 'draft']
  description text
  createdByPartyId int [ref: > Party.id]
  lastUsedAt timestamp
  createdAt timestamp [default: `now()`]
  updatedAt timestamp
}

Table TemplateContent {
  id int [pk, increment]
  templateId int [not null, ref: > Template.id]
  subject varchar
  bodyText text [not null]
  bodyHtml text
  createdAt timestamp [default: `now()`]
  updatedAt timestamp
}

Table AutoReplyRule {
  id int [pk, increment]
  tenantId int [not null, ref: > Tenant.id]
  channel TemplateChannel [not null]
  enabled boolean [default: true]
  templateId int [not null, ref: > Template.id]
  triggerType AutoReplyTriggerType [not null]
  cooldownMinutes int [default: 60]
  businessHoursJson json
  createdAt timestamp [default: `now()`]
  updatedAt timestamp
}

Table AutoReplyLog {
  id int [pk, increment]
  tenantId int [not null, ref: > Tenant.id]
  channel TemplateChannel [not null]
  partyId int [not null, ref: > Party.id]
  threadId int [ref: > MessageThread.id]
  ruleId int [ref: > AutoReplyRule.id]
  templateId int
  status AutoReplyStatus [not null]
  reason text
  createdAt timestamp [default: `now()`]
}

Table EmailSendLog {
  id int [pk, increment]
  tenantId int [not null, ref: > Tenant.id]
  to varchar [not null]
  from varchar [not null]
  subject varchar [not null]
  templateKey varchar
  templateId int
  category EmailSendCategory
  provider varchar [default: 'resend']
  providerMessageId varchar
  relatedInvoiceId int [ref: > Invoice.id]
  status EmailSendStatus [default: 'queued']
  error json
  createdAt timestamp [default: `now()`]
}

Table MessageThread {
  id int [pk, increment]
  tenantId int [not null, ref: > Tenant.id]
  subject varchar
  archived boolean [default: false]
  inquiryType varchar
  sourceListingSlug varchar
  guestEmail varchar
  guestName varchar
  lastMessageAt timestamp
  createdAt timestamp [default: `now()`]
  updatedAt timestamp
}

Table MessageParticipant {
  id int [pk, increment]
  threadId int [not null, ref: > MessageThread.id]
  partyId int [not null, ref: > Party.id]
  lastReadAt timestamp
  createdAt timestamp [default: `now()`]
}

Table Message {
  id int [pk, increment]
  threadId int [not null, ref: > MessageThread.id]
  senderPartyId int [not null, ref: > Party.id]
  body text [not null]
  isAutomated boolean [default: false]
  automationRuleId int
  createdAt timestamp [default: `now()`]
}

// =============================================================================
// DOCUMENTS & CONTRACTS
// =============================================================================

Table Document {
  id int [pk, increment]
  tenantId int [not null, ref: > Tenant.id]
  scope DocumentScope [not null]
  kind DocumentKind [default: 'generic']
  animalId int [ref: > Animal.id]
  ownershipChangeId int [ref: > AnimalOwnershipChange.id]
  offspringId int [ref: > Offspring.id]
  groupId int [ref: > OffspringGroup.id]
  invoiceId int [unique, ref: - Invoice.id]
  contractId int [ref: > Contract.id]
  title varchar [not null]
  storageKey varchar
  externalUrl varchar
  mimeType varchar
  bytes int
  visibility DocVisibility [default: 'PRIVATE']
  status DocStatus [default: 'PLACEHOLDER']
  createdAt timestamp [default: `now()`]
  updatedAt timestamp
}

Table Attachment {
  id int [pk, increment]
  tenantId int [not null, ref: > Tenant.id]
  planId int [ref: > BreedingPlan.id]
  animalId int [ref: > Animal.id]
  litterId int [ref: > Litter.id]
  offspringGroupId int [ref: > OffspringGroup.id]
  offspringId int [ref: > Offspring.id]
  attachmentPartyId int [ref: > Party.id]
  invoiceId int [ref: > Invoice.id]
  paymentId int [ref: > Payment.id]
  expenseId int [ref: > Expense.id]
  kind varchar [not null]
  storageProvider varchar [not null]
  storageKey varchar [not null]
  filename varchar [not null]
  mime varchar [not null]
  bytes int [not null]
  createdByUserId varchar [ref: > User.id]
  createdAt timestamp [default: `now()`]
}

Table ContractTemplate {
  id int [pk, increment]
  tenantId int [not null, ref: > Tenant.id]
  name varchar [not null]
  body varchar
  storageKey varchar
  description varchar
  isActive boolean [default: true]
  createdAt timestamp [default: `now()`]
  updatedAt timestamp
}

Table Contract {
  id int [pk, increment]
  tenantId int [not null, ref: > Tenant.id]
  templateId int [ref: > ContractTemplate.id]
  offspringId int [ref: > Offspring.id]
  groupId int [ref: > OffspringGroup.id]
  invoiceId int [unique, ref: - Invoice.id]
  title varchar [not null]
  status ContractStatus [default: 'draft']
  provider SignatureProvider [default: 'internal']
  providerEnvelopeId varchar
  issuedAt timestamp
  signedAt timestamp
  voidedAt timestamp
  expiresAt timestamp
  createdAt timestamp [default: `now()`]
  updatedAt timestamp
}

Table ContractParty {
  id int [pk, increment]
  tenantId int [not null, ref: > Tenant.id]
  contractId int [not null, ref: > Contract.id]
  userId varchar [ref: > User.id]
  partyId int [ref: > Party.id]
  role varchar
  email varchar
  name varchar
  signer boolean [default: true]
  order int
  status SignatureStatus [default: 'pending']
  signedAt timestamp
  createdAt timestamp [default: `now()`]
  updatedAt timestamp
}

Table SignatureEvent {
  id int [pk, increment]
  tenantId int [not null, ref: > Tenant.id]
  contractId int [not null, ref: > Contract.id]
  partyId int [ref: > ContractParty.id]
  status SignatureStatus [not null]
  at timestamp [default: `now()`]
  ipAddress varchar
  userAgent varchar
  message varchar
}

Table OffspringDocument {
  id int [pk, increment]
  tenantId int [not null, ref: > Tenant.id]
  offspringId int [not null, ref: > Offspring.id]
  name varchar [not null]
  templateId varchar
  provider EsignProvider
  status EsignStatus [default: 'DRAFT']
  sentAt timestamp
  viewedAt timestamp
  completedAt timestamp
  fileId int [ref: > Attachment.id]
  createdAt timestamp [default: `now()`]
  updatedAt timestamp
}

Table OffspringContract {
  id int [pk, increment]
  tenantId int [not null, ref: > Tenant.id]
  offspringId int [not null, ref: > Offspring.id]
  title varchar [not null]
  version varchar
  provider EsignProvider
  status EsignStatus [default: 'DRAFT']
  sentAt timestamp
  viewedAt timestamp
  signedAt timestamp
  fileId int [ref: > Attachment.id]
  buyerPartyId int [ref: > Party.id]
  createdAt timestamp [default: `now()`]
  updatedAt timestamp
}

// =============================================================================
// TAGS & TASKS
// =============================================================================

Table Tag {
  id int [pk, increment]
  tenantId int [not null, ref: > Tenant.id]
  name varchar [not null]
  module TagModule [not null]
  color varchar
  isArchived boolean [default: false]
  archivedAt timestamp
  createdAt timestamp [default: `now()`]
  updatedAt timestamp
}

Table TagAssignment {
  id int [pk, increment]
  tagId int [not null, ref: > Tag.id]
  taggedPartyId int [ref: > Party.id]
  animalId int [ref: > Animal.id]
  waitlistEntryId int [ref: > WaitlistEntry.id]
  offspringGroupId int [ref: > OffspringGroup.id]
  offspringId int [ref: > Offspring.id]
  createdAt timestamp [default: `now()`]
}

Table Task {
  id int [pk, increment]
  tenantId int [not null, ref: > Tenant.id]
  scope TaskScope [not null]
  groupId int [ref: > OffspringGroup.id]
  offspringId int [ref: > Offspring.id]
  title varchar [not null]
  notes varchar
  dueAt timestamp
  status TaskStatus [default: 'open']
  assignedToUserId varchar [ref: > User.id]
  createdAt timestamp [default: `now()`]
  updatedAt timestamp
}

Table HealthEvent {
  id int [pk, increment]
  tenantId int [not null, ref: > Tenant.id]
  offspringId int [not null, ref: > Offspring.id]
  kind HealthType [not null]
  occurredAt timestamp [not null]
  weightGrams int
  vaccineCode varchar
  dose varchar
  vetClinic varchar
  result varchar
  notes varchar
  recordedByUserId varchar [ref: > User.id]
  createdAt timestamp [default: `now()`]
  updatedAt timestamp
}

// =============================================================================
// PORTAL & AUDIT
// =============================================================================

Table PortalAccess {
  id int [pk, increment]
  tenantId int [not null, ref: > Tenant.id]
  partyId int [unique, not null, ref: - Party.id]
  status PortalAccessStatus [default: 'NO_ACCESS']
  userId varchar [ref: > User.id]
  membershipUserId varchar
  invitedAt timestamp
  activatedAt timestamp
  suspendedAt timestamp
  lastLoginAt timestamp
  createdByUserId varchar [ref: > User.id]
  updatedByUserId varchar [ref: > User.id]
  createdAt timestamp [default: `now()`]
  updatedAt timestamp
}

Table PortalInvite {
  id int [pk, increment]
  tenantId int [not null, ref: > Tenant.id]
  partyId int [not null, ref: > Party.id]
  emailNorm varchar [not null]
  userId varchar [ref: > User.id]
  roleToGrant TenantMembershipRole [default: 'CLIENT']
  statusToGrant TenantMembershipStatus [default: 'ACTIVE']
  tokenHash varchar [unique, not null]
  expiresAt timestamp [not null]
  sentAt timestamp [default: `now()`]
  usedAt timestamp
  membershipUserId varchar
  sentByUserId varchar [ref: > User.id]
  createdAt timestamp [default: `now()`]
  updatedAt timestamp
}

Table AuditEvent {
  id int [pk, increment]
  createdAt timestamp [default: `now()`]
  requestId varchar(64)
  ip varchar(45)
  userAgent text
  userId varchar(64)
  surface AuditSurface [not null]
  actorContext AuditActorContext
  tenantId int
  action varchar(64) [not null]
  outcome AuditOutcome [not null]
  detailJson json
}

// =============================================================================
// SCHEDULING
// =============================================================================

Table SchedulingEventTemplate {
  id int [pk, increment]
  tenantId int [not null, ref: > Tenant.id]
  name varchar [not null]
  eventType varchar [not null]
  description text
  status SchedulingEventStatus [default: 'DRAFT']
  defaultDurationMinutes int [default: 60]
  defaultCapacity int [default: 1]
  canCancel boolean [default: true]
  canReschedule boolean [default: true]
  nextStepsText text
  subjectType varchar
  offspringId int [ref: > Offspring.id]
  createdAt timestamp [default: `now()`]
  updatedAt timestamp
}

Table SchedulingAvailabilityBlock {
  id int [pk, increment]
  tenantId int [not null, ref: > Tenant.id]
  templateId int [ref: > SchedulingEventTemplate.id]
  offspringGroupId int [ref: > OffspringGroup.id]
  startAt timestamp [not null]
  endAt timestamp [not null]
  timezone varchar(64) [default: 'America/New_York']
  status SchedulingEventStatus [default: 'OPEN']
  location text
  createdAt timestamp [default: `now()`]
  updatedAt timestamp
}

Table SchedulingSlot {
  id int [pk, increment]
  tenantId int [not null, ref: > Tenant.id]
  blockId int [not null, ref: > SchedulingAvailabilityBlock.id]
  startsAt timestamp [not null]
  endsAt timestamp [not null]
  capacity int [default: 1]
  bookedCount int [default: 0]
  status SchedulingSlotStatus [default: 'AVAILABLE']
  mode SchedulingSlotMode
  location text
  createdAt timestamp [default: `now()`]
  updatedAt timestamp
}

Table SchedulingBooking {
  id int [pk, increment]
  tenantId int [not null, ref: > Tenant.id]
  slotId int [not null, ref: > SchedulingSlot.id]
  partyId int [not null, ref: > Party.id]
  eventId varchar(64) [not null]
  status SchedulingBookingStatus [default: 'CONFIRMED']
  bookedAt timestamp [default: `now()`]
  cancelledAt timestamp
  rescheduledAt timestamp
  clientNotes text
  breederNotes text
  nextSteps text
  rescheduledFromId int [ref: > SchedulingBooking.id]
  createdAt timestamp [default: `now()`]
  updatedAt timestamp
}
